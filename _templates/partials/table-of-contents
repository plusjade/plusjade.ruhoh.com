<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
  // Table Of Contents
  var Toc = {
    $container : null,
    $wrapper : null,

    init : function(container, wrapper){
      Toc.$container = $(container);
      Toc.$wrapper = $(wrapper);

      Toc.build();
      Toc.toggle();
      $(window).resize(function(){ Toc.toggle() })
    },

    build : function(){
      var h1 = [];
      var h2 = [];

      Toc.$wrapper.find("h1").each(function(){
        var h = {h1 : this, children : null }
        h.children = $(this).nextUntil("h1", "h2");
        h1.push(h);
      })
      var cache = "<ul class='nest'>";
      h1.forEach(function(node){
        cache += '<li><strong><a href="#'+ node.h1.id + '">'+$(node.h1).text()+'</a></strong></li>';

        node.children.each(function(){
          cache += '<li class="sub"><a href="#'+ this.id + '">'+ $(this).text() + '</a></li>';
        })
      })
      cache += "</ul>";

      Toc.$container.append(cache);
    },

    toggle :function(){
      if($(window).width() > 1000) Toc.$container.css({'position' :'fixed'});
      else Toc.$container.css({'position': 'relative'});
    }
  }
  
  
  Toc.init('#toc', '#novel');
  
</script>
<style type="text/css">
#toc { position:fixed;}
#toc ul { margin:0; }
#toc ul li { list-style:none;  line-height:1.8em}
#toc ul li strong { padding:2px 6px; border:1px solid #ccc; background:#eee; color:#333 }
#toc ul li.sub {
  margin-left:10px;
  
}
#toc ul li a { color:#555; }
</style>